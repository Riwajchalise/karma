<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  {% assign meta_title = page.title | default: site.title %}
  {% assign meta_description = page.description | default: site.description %}
  {% assign base_url = site.url | default: '' %}
  {% assign meta_image = base_url | append: site.baseurl | append: '/assets/poster.webp' %}
  {% assign canonical_url = base_url | append: site.baseurl | append: page.url %}
  <title>{{ meta_title }}</title>
  <meta name="description" content="{{ meta_description }}" />
  <meta name="keywords" content="Karma Squad, events, entertainment, tours, live shows, concerts, Melbourne, Abhaya Subba, Abhaya &amp; The Steam Engines, Abhaya Subba Melbourne, Abhaya Australia show, Nepali music Australia, Melbourne concerts, live Nepali music" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="{{ meta_title }}" />
  <meta property="og:description" content="{{ meta_description }}" />
  <meta property="og:image" content="{{ meta_image }}" />
  <meta property="og:url" content="{{ canonical_url }}" />
  <meta property="og:site_name" content="{{ site.title }}" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{ meta_title }}" />
  <meta name="twitter:description" content="{{ meta_description }}" />
  <meta name="twitter:image" content="{{ meta_image }}" />
  <link rel="canonical" href="{{ canonical_url }}" />
  <link rel="icon" type="image/x-icon" href="{{ '/assets/favicon.ico' | relative_url }}" />
  <link rel="stylesheet" href="{{ '/styles.css' | relative_url }}" />
</head>
<body>
  <div class="page">
    {% include navbar.html %}

    <main>
      {{ content }}
    </main>

    {% include footer.html %}
  </div>

  <script>
    const navToggle = document.getElementById('nav-toggle');
    const navLinks = document.querySelectorAll('.nav-links a');
    const backButton = document.querySelector('.back-button');

    navLinks.forEach(link => {
      link.addEventListener('click', () => {
        if (navToggle) navToggle.checked = false;
        document.body.classList.remove('nav-open');
      });
    });

    if (backButton) {
      backButton.addEventListener('click', () => {
        if (navToggle) navToggle.checked = false;
        document.body.classList.remove('nav-open');
      });
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && navToggle && navToggle.checked) {
        navToggle.checked = false;
        document.body.classList.remove('nav-open');
      }
    });

    if (navToggle) {
      navToggle.addEventListener('change', () => {
        document.body.classList.toggle('nav-open', navToggle.checked);
      });
    }

    // Contact form → Google Apps Script endpoint (replace URL below)
    (() => {
      const form = document.getElementById('contact-form');
      const status = document.getElementById('contact-status');
      const endpoint = 'https://script.google.com/macros/s/AKfycbwp_L-HoJukz5KDzQhR2ECPWaAoHUct9AZ89a39h0ipbOJL3m6D0ONWcPuuW4s5GQKn/exec';
      if (!form || !status) return;

      const setStatus = (type, message, iconContent = '') => {
        status.innerHTML = '';
        const icon = document.createElement('span');
        icon.className = `status-icon ${type === 'loading' ? 'status-loading' : type === 'success' ? 'status-success' : 'status-error'}`;
        if (type === 'success') icon.textContent = iconContent || '✓';
        status.appendChild(icon);
        if (message) {
          const text = document.createElement('span');
          text.textContent = message;
          status.appendChild(text);
        }
      };

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const payload = Object.fromEntries(formData.entries());
        payload.page = window.location.pathname;

        setStatus('loading', 'Sending...');
        try {
          await fetch(endpoint, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
          });
          form.reset();
          setStatus('success', 'Submitted', '✓');
        } catch (err) {
          setStatus('error', 'Could not send. Please try again.');
        }
      });
    })();
  </script>
</body>
</html>
